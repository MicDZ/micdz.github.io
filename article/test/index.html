<!DOCTYPE html>
<html lang="en,zh_cn,default">

<head>
  <meta charset="utf-8">
  
  <title></title>

  
<link rel="stylesheet" href="/css/custom.css">

  
<link rel="stylesheet" href="/css/main.css">

  
<link rel="stylesheet" href="/css/normalize.css">

  <style>
  a:not(.icon):not(.clustrmaps-map-control) {
    text-decoration-color: #0FA0CE;
    background-image: linear-gradient(
      to bottom,
      rgba(0, 0, 0, 0) 50%,
      #0FA0CE 50%
    );
  }
  blockquote {
    border-left: 8px solid #0FA0CE;
  }
  .nanobar .bar {
    background: #0FA0CE;
  }
</style>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/png" href="/img/h.jpeg">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont@1.1.0/style.css" />

  <!-- KaTeX support -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.css" integrity="sha384-OH8qNTHoMMVNVcKdKewlipV4SErXqccxxlg6HC9Cwjr5oZu2AdBej1TndeCirael" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.js" integrity="sha384-ImWHyYvDPlRzwFnvLhG9Jcpm/7qL4SVIuJK0C6Rj+Mf7fpeNJCLCynC+EVz4kCSA" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.js"
        integrity="sha512-EKW5YvKU3hpyyOcN6jQnAxO/L8gts+YdYV6Yymtl8pk9YlYFtqJgihORuRoBXK8/cOIlappdU6Ms8KdK6yBCgA=="
        crossorigin="anonymous" referrerpolicy="no-referrer">
</script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pseudocode@2.4.1/build/pseudocode.min.css">
<script src="https://cdn.jsdelivr.net/npm/pseudocode@2.4.1/build/pseudocode.min.js">
</script>
<!-- Prism support ./js/prism.js-->
  
<link rel="stylesheet" href="/css/prism.css">

<meta name="generator" content="Hexo 7.0.0"><link rel="alternate" href="/atom.xml" title="MicDZ's Blog" type="application/atom+xml">
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="row">

    <div class="two columns" style="max-width: 50px">
      <h1 class="mt-2 mode">
        <div onclick=setDarkMode(true) id="darkBtn"></div>
        <div onclick=setDarkMode(false) id="lightBtn" class=hidden></div>
        <script >
          if (localStorage.getItem('preferredTheme') == 'dark') {
            setDarkMode(true)
          }
          function setDarkMode(isDark) {
            var darkBtn = document.getElementById('darkBtn')
            var lightBtn = document.getElementById('lightBtn')
            if (isDark) {
              lightBtn.style.display = "block"
              darkBtn.style.display = "none"
              localStorage.setItem('preferredTheme', 'dark');
            } else {
              lightBtn.style.display = "none"
              darkBtn.style.display = "block"
              localStorage.removeItem('preferredTheme');
            }
            document.body.classList.toggle("darkmode");
          }
        </script>
      </h1>
    </div>
     
    <div class="six columns ml-1">
      <h1 class="mt-2 site-title">
        MicDZ&#39;s Blog
      </h1>
    </div>
  
    <div class="twelve columns">
      <div class="row">
        <div class="right">
          
            <a href="/" class="ml">Home</a>
          
          
          
            <a href="/archives" class="ml">Archives</a>
             

          <!-- <a href="/" class="ml">About</a> -->
          
            <a href="/friends" class="ml">Friends</a>
           
          
          
        </div>
      </div>
      <hr style="margin-bottom: 2.6rem">
    </div>
    


  </div>
          <div>
            <!-- <div class="trans"> -->
              


<title></title>

<h1></h1>

<div class="right">
  
 — <p class="info">          Aug. 8, 2025</p>
  
</div>

<hr> 






<div class="article">
  
  
    <blockquote>
      <p>This article is written in Chinese. The English version is translated by GPT-4o. Please refer to the original <a href="/">Chinese version</a> for the original content.</p>
    </blockquote>
    <hr>
  
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complex Probability Distribution Flow Visualization</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f4f4f9;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 {
            font-weight: 500;
            color: #2c3e50;
        }
        .container {
            display: flex;
            flex-direction: column;
            border: 1px solid #ccc;
            padding: 20px;
            margin: 20px auto;
            max-width: 800px;
            width: 95%;
            background-color: #fff;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-radius: 8px;
        }
        .canvas-wrapper {
            position: relative;
            width: 100%;
            padding-top: 75%; /* 4:3 Aspect Ratio */
            margin-bottom: 20px;
            border-radius: 6px;
            overflow: hidden;
        }
        #flowCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #fdfdfa;
        }
        .controls {
            width: 100%;
            padding: 10px 0;
        }
        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 16px;
            font-weight: 500;
        }
        .control-group input[type="range"] {
            width: 100%;
            cursor: pointer;
        }
        .slider-value {
            font-weight: bold;
            color: #2980b9;
            font-family: monospace;
        }
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        .legend-symbol-line {
            width: 20px;
            height: 2px;
        }
        .legend-symbol-point {
             width: 8px;
             height: 8px;
             border-radius: 50%;
        }
    </style>
</head>
<body>

    <h1>Visualization of a Learned Distribution Flow</h1>

    <div class="container">
        <div class="canvas-wrapper">
            <canvas id="flowCanvas"></canvas>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label for="timeSlider">Transformation Time t: <span id="timeValue" class="slider-value">0.00</span></label>
                <input type="range" id="timeSlider" min="0" max="1" step="0.005" value="0">
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-symbol-line" style="background-color: #e74c3c;"></div>
                <span>Deforming Space (Grid Map)</span>
            </div>
            <div class="legend-item">
                <div class="legend-symbol-point" style="background-color: #2c3e50;"></div>
                <span>Transported Samples</span>
            </div>
            <div class="legend-item">
                <div class="legend-symbol-line" style="background-color: #8e44ad;"></div>
                <span>Probability Contours</span>
            </div>
        </div>
    </div>

    <script>
        const flowCanvas = document.getElementById('flowCanvas');
        const canvasContext = flowCanvas.getContext('2d');
        const timeSlider = document.getElementById('timeSlider');
        const timeValueLabel = document.getElementById('timeValue');

        // --- Configuration ---
        const NUM_SAMPLES = 300;
        const GRID_DENSITY = 20;

        // Source Distribution p_0: Standard Gaussian N(0, I)
        const sourceDist = {
            mean: [0, 0],
            cov: [[1, 0], [0, 1]]
        };

        // Target Distribution p_1: A Gaussian Mixture Model (GMM)
        const targetDist = [
            { weight: 0.6, mean: [2.5, 2.0], cov: [[0.8, -0.6], [-0.6, 0.8]] },
            { weight: 0.4, mean: [-1.5, -2.5], cov: [[1.0, 0.5], [0.5, 0.4]] }
        ];

        let baseSamples = []; // {x0, z} pairs
        let initialGrid = [];

        // --- Matrix Math Helpers ---
        const mat = {
            add: (A, B) => A.map((row, i) => row.map((val, j) => val + B[i][j])),
            scale: (s, A) => A.map(row => row.map(val => val * s)),
            // Cholesky decomposition for sampling from a Gaussian
            cholesky: (A) => {
                const L = [[0, 0], [0, 0]];
                L[0][0] = Math.sqrt(A[0][0]);
                L[1][0] = A[1][0] / L[0][0];
                L[1][1] = Math.sqrt(A[1][1] - L[1][0] * L[1][0]);
                return L;
            }
        };

        // --- Core Logic ---

        // Sample from a GMM
        function sampleGMM(gmm) {
            const r = Math.random();
            let cumulativeWeight = 0;
            for (const component of gmm) {
                cumulativeWeight += component.weight;
                if (r <= cumulativeWeight) {
                    // Sample from this Gaussian component
                    const u = [Math.random() * 2 - 1, Math.random() * 2 - 1]; // Poor man's normal
                    const z0 = Math.sqrt(-2 * Math.log(Math.random())) * Math.cos(2 * Math.PI * Math.random());
                    const z1 = Math.sqrt(-2 * Math.log(Math.random())) * Math.sin(2 * Math.PI * Math.random());

                    const L = mat.cholesky(component.cov);
                    const x = component.mean[0] + L[0][0] * z0;
                    const y = component.mean[1] + L[1][0] * z0 + L[1][1] * z1;
                    return [x, y];
                }
            }
            return gmm[0].mean; // Fallback
        }

        // Generate base samples for the transport plan
        function setupSamples() {
            baseSamples = [];
            const L_source = mat.cholesky(sourceDist.cov);
            for (let i = 0; i < NUM_SAMPLES; i++) {
                const z0 = Math.sqrt(-2 * Math.log(Math.random())) * Math.cos(2 * Math.PI * Math.random());
                const z1 = Math.sqrt(-2 * Math.log(Math.random())) * Math.sin(2 * Math.PI * Math.random());
                
                const x0_x = sourceDist.mean[0] + L_source[0][0] * z0;
                const x0_y = sourceDist.mean[1] + L_source[1][0] * z0 + L_source[1][1] * z1;

                const z = sampleGMM(targetDist);
                baseSamples.push({ x0: [x0_x, x0_y], z: z });
            }
        }
        
        function setupGrid() {
            initialGrid = [];
            const step = 10 / GRID_DENSITY;
            for (let i = 0; i <= GRID_DENSITY; i++) {
                initialGrid[i] = [];
                for (let j = 0; j <= GRID_DENSITY; j++) {
                    initialGrid[i][j] = [-5 + j * step, -5 + i * step];
                }
            }
        }

        function mapCoords(p) {
            const scale = flowCanvas.width / 12;
            return {
                x: flowCanvas.width / 2 + p[0] * scale,
                y: flowCanvas.height / 2 - p[1] * scale
            };
        }

        function draw() {
            const t = parseFloat(timeSlider.value);
            timeValueLabel.textContent = t.toFixed(2);

            canvasContext.clearRect(0, 0, flowCanvas.width, flowCanvas.height);
            
            // 1. Draw the deforming grid
            drawDeformingGrid(t);

            // 2. Calculate the interpolated distribution p_t and draw its contours
            const interpolatedDist = targetDist.map(comp => {
                const mean_t = [
                    (1 - t) * sourceDist.mean[0] + t * comp.mean[0],
                    (1 - t) * sourceDist.mean[1] + t * comp.mean[1]
                ];
                const cov_t = mat.add(
                    mat.scale(Math.pow(1 - t, 2), sourceDist.cov),
                    mat.scale(Math.pow(t, 2), comp.cov)
                );
                return { weight: comp.weight, mean: mean_t, cov: cov_t };
            });
            drawGMMContours(interpolatedDist);

            // 3. Draw the transported samples
            drawTransportedSamples(t);
        }
        
        function drawTransportedSamples(t) {
            canvasContext.fillStyle = '#2c3e50';
            baseSamples.forEach(s => {
                const xt = [
                    (1 - t) * s.x0[0] + t * s.z[0],
                    (1 - t) * s.x0[1] + t * s.z[1]
                ];
                const p = mapCoords(xt);
                canvasContext.beginPath();
                canvasContext.arc(p.x, p.y, 2, 0, 2 * Math.PI);
                canvasContext.fill();
            });
        }
        
        // This is a deterministic, non-linear warp for visual effect
        function warp(p, t) {
            const [x, y] = p;
            const target_mean_1 = targetDist[0].mean;
            const target_mean_2 = targetDist[1].mean;

            // A simple non-linear warp that pulls points towards the target means
            const influence = Math.tanh(x*0.3); // Split space left/right of y-axis
            const target_mean = (influence > 0) ? target_mean_1 : target_mean_2;
            
            const xt = (1 - t) * x + t * (target_mean[0] + 0.2*(x-target_mean[0]));
            const yt = (1 - t) * y + t * (target_mean[1] + 0.2*(y-target_mean[1]));

            return [xt, yt];
        }

        function drawDeformingGrid(t) {
            canvasContext.strokeStyle = 'rgba(231, 76, 60, 0.7)'; // Red
            canvasContext.lineWidth = 1;

            for (let i = 0; i <= GRID_DENSITY; i++) {
                // Draw horizontal lines
                canvasContext.beginPath();
                for (let j = 0; j <= GRID_DENSITY; j++) {
                    const p = mapCoords(warp(initialGrid[i][j], t));
                    if (j === 0) canvasContext.moveTo(p.x, p.y);
                    else canvasContext.lineTo(p.x, p.y);
                }
                canvasContext.stroke();
                
                // Draw vertical lines
                canvasContext.beginPath();
                for (let j = 0; j <= GRID_DENSITY; j++) {
                    const p = mapCoords(warp(initialGrid[j][i], t));
                    if (j === 0) canvasContext.moveTo(p.x, p.y);
                    else canvasContext.lineTo(p.x, p.y);
                }
                canvasContext.stroke();
            }
        }
        
        function drawGMMContours(gmm) {
            canvasContext.strokeStyle = '#8e44ad'; // Purple
            canvasContext.lineWidth = 1.5;
            gmm.forEach(comp => {
                // Draw ellipses for each component (approximation of GMM contours)
                const [x, y] = comp.mean;
                const cov = comp.cov;
                const det = cov[0][0] * cov[1][1] - cov[0][1] * cov[1][0];
                if (det <= 0) return;

                const trace = cov[0][0] + cov[1][1];
                const l1 = trace/2 + Math.sqrt(Math.pow(trace,2)/4 - det);
                const l2 = trace/2 - Math.sqrt(Math.pow(trace,2)/4 - det);
                const angle = (cov[0][0] === cov[1][1]) ? 0 : Math.atan2(2 * cov[0][1], cov[0][0] - cov[1][1]) / 2;
                
                const scale = flowCanvas.width / 12;
                const pos = mapCoords([x, y]);

                for (let i = 1; i <= 4; i++) {
                    canvasContext.globalAlpha = Math.max(0, 0.8 - i * 0.15);
                    canvasContext.beginPath();
                    canvasContext.ellipse(pos.x, pos.y, Math.sqrt(l1) * i * scale, Math.sqrt(l2) * i * scale, angle, 0, 2 * Math.PI);
                    canvasContext.stroke();
                }
            });
            canvasContext.globalAlpha = 1.0;
        }

        function handleResize() {
            const dpi = window.devicePixelRatio || 1;
            const wrapper = document.querySelector('.canvas-wrapper');
            flowCanvas.width = wrapper.offsetWidth * dpi;
            flowCanvas.height = wrapper.offsetHeight * dpi;
            canvasContext.scale(dpi, dpi);
            draw();
        }

        // --- Initialization ---
        window.addEventListener('resize', handleResize);
        timeSlider.addEventListener('input', draw);
        
        setupSamples();
        setupGrid();
        handleResize(); // Initial call
        
    </script>
</body>
</html>
</div>
<p class="right">
    
        <script>
            document.addEventListener("DOMContentLoaded", function() {
              var levelCount = [0, 0, 0, 0, 0];
              var headings = document.querySelectorAll('h2, h3, h4, h5, h6');
          
              headings.forEach(function(heading) {
                var titleLevel = parseInt(heading.tagName.charAt(1)-1);
                if (!isNaN(titleLevel)) {
                  levelCount[titleLevel - 1]++;
                  for (var i = titleLevel; i < levelCount.length; i++) {
                    levelCount[i] = 0;
                  }
                  heading.innerHTML = levelCount.slice(0, titleLevel).join('.') + '&nbsp;' + heading.innerHTML;
                }
              });
            });
        </script>
        
           —           Aug. 8, 2025
          
    
</p>


            <!-- </div> -->
            <div class="row mt-2">
    
    <p id="copyright">
        
        Unless otherwise stated, all content on this blog is licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a><span class="d-none d-sm-inline"> | </span>
        <a href="/atom.xml" target="_blank" rel="noopener" class="btn btn-outline-secondary btn-sm">RSS subscribe</a> <span class="d-none d-sm-inline"> | </span>
        <a href="/friends">Friends</a>
        <br>
        
        <a target="_blank" rel="noopener" href="https://beian.miit.gov.cn">鄂ICP备2025091178号</a> <span class="d-none d-sm-inline"> | </span>
        <span class="d-none d-sm-inline"> 
        


        


    
        
            对应的中文页面尚未上线
        
    


        

    </p>
    <script type='text/javascript' id='clustrmaps' src='//cdn.clustrmaps.com/map_v2.js?cl=ffffff&w=250&t=n&d=tomGCTh1CxWc_-uuNllmA6Nl5mVnvkzy2svb86OrEyc&co=2d78ad&cmo=3acc3a&cmn=ff5353&ct=ffffff'></script>
    
</div> 
          </div>
    
        </div>
    
      </div>
</body>

</html>